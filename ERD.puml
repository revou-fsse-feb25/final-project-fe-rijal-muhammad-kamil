@startuml erd

' === User ===
entity "User" as user {
  +user_id : int <<PK, AUTOINCREMENT>>
  --
  email : varchar(51) <<NOT NULL, UNIQUE>>
  password : varchar(255) <<NOT NULL>>
  role : enum('ATTENDEE','EVENT_ORGANIZER','ADMIN') <<NOT NULL, DEFAULT 'ATTENDEE'>>
  --
  first_name : varchar(51) <<NOT NULL>>
  last_name : varchar(51) <<NOT NULL>>
  date_of_birth : date <<NOT NULL>>
  gender : enum('Male','Female') <<NOT NULL>>
  phone_number : varchar(14) <<NOT NULL, UNIQUE>>
  status : enum('ACTIVE','SUSPENDED','DELETED') <<NOT NULL, DEFAULT 'ACTIVE'>>
  created_at : datetime <<NOT NULL, DEFAULT CURRENT_TIMESTAMP>>
  updated_at : datetime <<NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP>>
}

' === Event Organizer ===
entity "Event_Organizer" as event_organizer {
  +organizer_id : int <<PK, AUTOINCREMENT>>
  +user_id : int <<FK, NOT NULL, UNIQUE>>
  --
  name : varchar(127) <<NOT NULL, UNIQUE>>
  image_url : varchar(255) <<NULL>>
  created_at : datetime <<NOT NULL, DEFAULT CURRENT_TIMESTAMP>>
  updated_at : datetime <<NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP>>
}

' === Event Category ===
entity "Event_Category" as event_category {
  +category_id : int <<PK, AUTOINCREMENT>>
  --
  name : varchar(51) <<NOT NULL, UNIQUE>>
  created_at : datetime <<NOT NULL, DEFAULT CURRENT_TIMESTAMP>>
  updated_at : datetime <<NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP>>
}

' === Event ===
entity "Event" as event {
  +event_id : int <<PK, AUTOINCREMENT>>
  +category_id : int <<FK, NOT NULL>>
  +organizer_id : int <<FK, NOT NULL>>
  --
  title : varchar(127) <<NOT NULL>>
  description : text <<NOT NULL>>
  terms : text <<NOT NULL>>
  location : varchar(127) <<NOT NULL>>
  image_url : varchar(255) <<NOT NULL>>
  status : enum('active','inactive','completed') <<NOT NULL, DEFAULT 'active'>>
  created_at : datetime <<NOT NULL, DEFAULT CURRENT_TIMESTAMP>>
  updated_at : datetime <<NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP>>
}

' === Event Period ===
entity "Event_Period" as event_period {
  +period_id : int <<PK, AUTOINCREMENT>>
  +event_id : int <<FK, NOT NULL>>
  --
  name : varchar(127) <<NOT NULL>>
  start_date : date <<NOT NULL>>
  end_date : date <<NOT NULL>>
  start_time : time <NOT NULL>>
  end_time : time <<NOT NULL>>
  status : enum('upcoming','ongoing','completed') <<NOT NULL, DEFAULT 'upcoming'>>
  created_at : datetime <<NOT NULL, DEFAULT CURRENT_TIMESTAMP>>
  updated_at : datetime <<NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP>>
}

' === Ticket Type Category (master/admin controlled) ===
entity "Ticket_Type_Category" as ticket_type_category {
  +category_id : int <<PK, AUTOINCREMENT>>
  --
  name : varchar(51) <<NOT NULL, UNIQUE>>
  created_at : datetime <<NOT NULL, DEFAULT CURRENT_TIMESTAMP>>
  updated_at : datetime <<NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP>>
}

' === Ticket Type ===
entity "Ticket_Type" as ticket_type {
  +type_id : int <<PK, AUTOINCREMENT>>
  +period_id : int <<FK, NOT NULL>>
  +category_id : int <<FK, NOT NULL>>
  --
  price : decimal(10,2) <<NOT NULL>>
  discount : decimal(10,2) <<NULL>>
  quota : int <<NOT NULL>>
  status : enum('available','sold out') <<NOT NULL, DEFAULT 'available'>>
  created_at : datetime <<NOT NULL, DEFAULT CURRENT_TIMESTAMP>>
  updated_at : datetime <<NOT NULL, DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP>>
}

' === Ticket (user purchases) ===
entity "Ticket" as ticket {
  +ticket_id : int <<PK, AUTOINCREMENT>>
  +type_id : int <<FK, NOT NULL>>
  +buyer_id : int <<FK, NULL>>
  --
  ticket_code : varchar(51) <<NOT NULL, UNIQUE>>
  created_at : datetime <<NOT NULL, DEFAULT CURRENT_TIMESTAMP>>
}

' === Relasi ===
user ||--o{ ticket : "purchases"
user ||--|| event_organizer : "is"
event_category ||--o{ event : "categorizes"
event_organizer ||--o{ event : "organizes"
event ||--o{ event_period : "has per day"
ticket_type_category ||--o{ ticket_type : "defines"
event_period ||--o{ ticket_type : "offers"
ticket_type ||--o{ ticket : "generates"

@enduml
